<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <meta name="Generator" content="kettle-cookbook - see http://code.google.com/p/kettle-cookbook/">
      <!--
            Debugging info - please ignore
            param_filename: "/home/mark/mozilla/etl/Log-Processing-ETL/etl/common/get_location_id_with_update.ktr"
            normalized_filename: "/home/mark/mozilla/etl/Log-Processing-ETL/etl/common/get_location_id_with_update.ktr"
            file: 1
            document: 1
            document-element: transformation
            name: 
            relative-path: "/common"
            documentation-root: "../.."
        -->
      <title>Kettle Documentation: transformation ""</title>
      <link rel="shortcut icon" type="image/x-icon" href="../../images/spoon.png">
      <link rel="stylesheet" type="text/css" href="../../css/kettle.css">
      <link rel="stylesheet" type="text/css" href="../../css/transformation.css">
      <link rel="stylesheet" type="text/css" href="../../css/shCoreDefault.css">
   </head>
   <body class="kettle-file" onload="drawHops()">
      <div class="quicklinks"><a href="#diagram">Diagram</a>
         |   <a href="#Steps">Steps</a>
         |   <a href="#parameters">Parameters</a>
         |   <a href="#variables">Variables</a>
         |   <a href="#connections">Database Connections</a>
         |   <a href="#files">Flat Files</a></div>
      <h1>Transformation: "get_location_id_with_update"</h1>
      <p>Geocode an IP Address and look up the location_id</p>
      <p>Geocode an IP Address, look up the location_id in the locations table, and insert the location if it is not present.
         
         The contents of this file are subject to the terms of the Mozilla Public
         License, v. 2.0. If a copy of the MPL was not distributed with this file,
         You can obtain one at http://mozilla.org/MPL/2.0/.
         
      </p>
      <h2>High Level Data Flow Diagram</h2>
      <table>
         <thead>
            <tr>
               <th>Input (0)</th>
               <th>Transform</th>
               <th>Output (1)</th>
            </tr>
         </thead>
         <tbody>
            <tr>
               <td></td>
               <td></td>
               <td>
                  <div>Insert / Update</div>
               </td>
            </tr>
         </tbody>
      </table>
      <h2><a name="diagram">Diagram</a></h2>
      <div class="diagram" id="diagram" style="&#xA;            width: 582px;&#xA;            height: 427px;&#xA;        "><a name="Database lookup-icon"></a><div id="Database lookup" class="&#xA;                    step-icon&#xA;                    step-icon-DBLookup" style="&#xA;                    left:300px;&#xA;                    top:280px;&#xA;                ">
            <div class="step-hops"><a class="&#xA;                                step-hop&#xA;                                &#xA;                                    step-hop-enabled&#xA;                                    step-hop-distribute-data " href="#Insert / Update"></a></div>
         </div><a class="&#xA;                    step-label&#xA;                    " href="#Database lookup-text" style="&#xA;                    top:312px;&#xA;                    left:280px;                    &#xA;                ">Database lookup</a><a name="Find missing locations-icon"></a><div id="Find missing locations" class="&#xA;                    step-icon&#xA;                    step-icon-FilterRows" style="&#xA;                    left:300px;&#xA;                    top:120px;&#xA;                ">
            <div class="step-hops"><a class="&#xA;                                step-hop&#xA;                                &#xA;                                    step-hop-enabled&#xA;                                    step-hop-true " href="#Remove location_id"></a><a class="&#xA;                                step-hop&#xA;                                &#xA;                                    step-hop-enabled&#xA;                                    step-hop-false " href="#Mapping output specification"></a></div>
         </div><a class="&#xA;                    step-label&#xA;                    " href="#Find missing locations-text" style="&#xA;                    top:152px;&#xA;                    left:270.6666666666667px;                    &#xA;                ">Find missing locations</a><a name="Insert / Update-icon"></a><div id="Insert / Update" class="&#xA;                    step-icon&#xA;                    step-icon-InsertUpdate" style="&#xA;                    left:400px;&#xA;                    top:280px;&#xA;                ">
            <div class="step-hops"><a class="&#xA;                                step-hop&#xA;                                &#xA;                                    step-hop-enabled&#xA;                                    step-hop-distribute-data " href="#Lookup new location_id"></a></div>
         </div><a class="&#xA;                    step-label&#xA;                    " href="#Insert / Update-text" style="&#xA;                    top:312px;&#xA;                    left:380px;                    &#xA;                ">Insert / Update</a><a name="Lookup location_id-icon"></a><div id="Lookup location_id" class="&#xA;                    step-icon&#xA;                    step-icon-DBLookup" style="&#xA;                    left:180px;&#xA;                    top:120px;&#xA;                ">
            <div class="step-hops"><a class="&#xA;                                step-hop&#xA;                                &#xA;                                    step-hop-enabled&#xA;                                    step-hop-distribute-data " href="#Find missing locations"></a></div>
         </div><a class="&#xA;                    step-label&#xA;                    " href="#Lookup location_id-text" style="&#xA;                    top:152px;&#xA;                    left:156px;                    &#xA;                ">Lookup location_id</a><a name="Lookup new location_id-icon"></a><div id="Lookup new location_id" class="&#xA;                    step-icon&#xA;                    step-icon-DBLookup" style="&#xA;                    left:500px;&#xA;                    top:280px;&#xA;                ">
            <div class="step-hops"><a class="&#xA;                                step-hop&#xA;                                &#xA;                                    step-hop-enabled&#xA;                                    step-hop-distribute-data " href="#Remove continent"></a></div>
         </div><a class="&#xA;                    step-label&#xA;                    " href="#Lookup new location_id-text" style="&#xA;                    top:312px;&#xA;                    left:470.6666666666667px;                    &#xA;                ">Lookup new location_id</a><a name="Mapping input specification-icon"></a><div id="Mapping input specification" class="&#xA;                    step-icon&#xA;                    step-icon-MappingInput" style="&#xA;                    left:60px;&#xA;                    top:40px;&#xA;                ">
            <div class="step-hops"><a class="&#xA;                                step-hop&#xA;                                &#xA;                                    step-hop-enabled&#xA;                                    step-hop-distribute-data " href="#MaxMind GeoIP Lookup"></a></div>
         </div><a class="&#xA;                    step-label&#xA;                    " href="#Mapping input specification-text" style="&#xA;                    top:72px;&#xA;                    left:24px;                    &#xA;                ">Mapping input specification</a><a name="Mapping output specification-icon"></a><div id="Mapping output specification" class="&#xA;                    step-icon&#xA;                    step-icon-MappingOutput" style="&#xA;                    left:500px;&#xA;                    top:120px;&#xA;                ">
            <div class="step-hops"></div>
         </div><a class="&#xA;                    step-label&#xA;                    " href="#Mapping output specification-text" style="&#xA;                    top:152px;&#xA;                    left:462.6666666666667px;                    &#xA;                ">Mapping output specification</a><a name="MaxMind GeoIP Lookup-icon"></a><div id="MaxMind GeoIP Lookup" class="&#xA;                    step-icon&#xA;                    step-icon-MaxMindGeoIPLookup" style="&#xA;                    left:60px;&#xA;                    top:120px;&#xA;                ">
            <div class="step-hops"><a class="&#xA;                                step-hop&#xA;                                &#xA;                                    step-hop-enabled&#xA;                                    step-hop-distribute-data " href="#Lookup location_id"></a></div>
         </div><a class="&#xA;                    step-label&#xA;                    " href="#MaxMind GeoIP Lookup-text" style="&#xA;                    top:152px;&#xA;                    left:33.33333333333333px;                    &#xA;                ">MaxMind GeoIP Lookup</a><a name="Remove continent-icon"></a><div id="Remove continent" class="&#xA;                    step-icon&#xA;                    step-icon-SelectValues" style="&#xA;                    left:500px;&#xA;                    top:200px;&#xA;                ">
            <div class="step-hops"><a class="&#xA;                                step-hop&#xA;                                &#xA;                                    step-hop-enabled&#xA;                                    step-hop-distribute-data " href="#Mapping output specification"></a></div>
         </div><a class="&#xA;                    step-label&#xA;                    " href="#Remove continent-text" style="&#xA;                    top:232px;&#xA;                    left:478.6666666666667px;                    &#xA;                ">Remove continent</a><a name="Remove location_id-icon"></a><div id="Remove location_id" class="&#xA;                    step-icon&#xA;                    step-icon-SelectValues" style="&#xA;                    left:300px;&#xA;                    top:200px;&#xA;                ">
            <div class="step-hops"><a class="&#xA;                                step-hop&#xA;                                &#xA;                                    step-hop-enabled&#xA;                                    step-hop-distribute-data " href="#Database lookup"></a></div>
         </div><a class="&#xA;                    step-label&#xA;                    " href="#Remove location_id-text" style="&#xA;                    top:232px;&#xA;                    left:276px;                    &#xA;                ">Remove location_id</a>
         
         <div class="note" style="&#xA;&#x9;&#x9;&#x9;left: 46px;&#xA;&#x9;&#x9;&#x9;top: 183px;&#xA;&#x9;&#x9;&#x9;width: 124px;&#xA;&#x9;&#x9;&#x9;height: px;&#xA;&#x9;&#x9;&#x9;font-family: Sans;&#xA;&#x9;&#x9;&#x9;font-size: 8;&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;color: rgb(0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,0);&#xA;&#x9;&#x9;&#x9;background-color: rgb(255&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,165&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,0);&#xA;&#x9;&#x9;&#x9;border-color: rgb(100&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,100&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,100);&#xA;&#x9;&#x9;">Geocode incoming IP</div>
         
         <div class="note" style="&#xA;&#x9;&#x9;&#x9;left: 352px;&#xA;&#x9;&#x9;&#x9;top: 76px;&#xA;&#x9;&#x9;&#x9;width: 118px;&#xA;&#x9;&#x9;&#x9;height: px;&#xA;&#x9;&#x9;&#x9;font-family: Sans;&#xA;&#x9;&#x9;&#x9;font-size: 8;&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;color: rgb(0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,0);&#xA;&#x9;&#x9;&#x9;background-color: rgb(255&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,165&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,0);&#xA;&#x9;&#x9;&#x9;border-color: rgb(100&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,100&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,100);&#xA;&#x9;&#x9;">The location_id was
            successfully found
         </div>
         
         <div class="note" style="&#xA;&#x9;&#x9;&#x9;left: 341px;&#xA;&#x9;&#x9;&#x9;top: 339px;&#xA;&#x9;&#x9;&#x9;width: 145px;&#xA;&#x9;&#x9;&#x9;height: px;&#xA;&#x9;&#x9;&#x9;font-family: Sans;&#xA;&#x9;&#x9;&#x9;font-size: 8;&#xA;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;color: rgb(0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,0);&#xA;&#x9;&#x9;&#x9;background-color: rgb(255&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,165&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,0);&#xA;&#x9;&#x9;&#x9;border-color: rgb(100&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,100&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,100);&#xA;&#x9;&#x9;">Create a new "locations"
            record and fetch its 
            location_id
         </div>
         
      </div>
      <h2><a name="variables">Variables</a></h2>
      <p>This transformation reads the following variables:</p>
      <table>
         <thead>
            <tr>
               <th>Name</th>
               <th>Value</th>
               <th>Connections</th>
               <th>Steps</th>
            </tr>
         </thead>
         <tbody>
            <tr>
               <th>METRICS_MYSQL_HOST</th>
               <td></td>
               <td></td>
               <td></td>
            </tr>
            <tr>
               <th>METRICS_MYSQL_NAME</th>
               <td></td>
               <td></td>
               <td></td>
            </tr>
            <tr>
               <th>METRICS_MYSQL_PORT</th>
               <td></td>
               <td>, </td>
               <td></td>
            </tr>
            <tr>
               <th>METRICS_MYSQL_USER</th>
               <td></td>
               <td></td>
               <td></td>
            </tr>
            <tr>
               <th>METRICS_MYSQL_PASS</th>
               <td></td>
               <td></td>
               <td></td>
            </tr>
         </tbody>
      </table>
      <h2><a name="connections">Database Connections</a></h2>
      <p>This transformation defines 1 database connections.</p>
      <h3>Database Connection Summary</h3>
      <table>
         <thead>
            <tr>
               <th>
                  							Name
                  						
               </th>
               <th>
                  							Type
                  						
               </th>
               <th>
                  							Access
                  						
               </th>
               <th>
                  							Host
                  						
               </th>
               <th>
                  							Port
                  						
               </th>
               <th>
                  							User
                  						
               </th>
               <th>
                  							Used in Steps
               </th>
            </tr>
         </thead>
         <tbody>
            <tr>
               <th><a href="#connection.metrics mysql">metrics mysql</a></th>
               <td>MYSQL</td>
               <td>Native</td>
               <td>${METRICS_MYSQL_HOST}</td>
               <td>${METRICS_MYSQL_PORT}</td>
               <td>${METRICS_MYSQL_USER}</td>
               <td><a href="#metrics mysql">Database lookup</a>, <a href="#metrics mysql">Insert / Update</a>, <a href="#metrics mysql">Lookup location_id</a>, <a href="#metrics mysql">Lookup new location_id</a></td>
            </tr>
         </tbody>
      </table>
      <h3>Database Connection Details</h3>
      <h4><a name="connection.metrics mysql">metrics mysql</a></h4>
      <table>
         <thead>
            <tr>
               <th>Property</th>
               <th>Value</th>
            </tr>
         </thead>
         <tbody>
            <tr>
               <td>name</td>
               <td>metrics mysql</td>
            </tr>
            <tr>
               <td>server</td>
               <td>${METRICS_MYSQL_HOST}</td>
            </tr>
            <tr>
               <td>type</td>
               <td>MYSQL</td>
            </tr>
            <tr>
               <td>access</td>
               <td>Native</td>
            </tr>
            <tr>
               <td>database</td>
               <td>${METRICS_MYSQL_NAME}</td>
            </tr>
            <tr>
               <td>port</td>
               <td>${METRICS_MYSQL_PORT}</td>
            </tr>
            <tr>
               <td>username</td>
               <td>${METRICS_MYSQL_USER}</td>
            </tr>
            <tr>
               <td>password</td>
               <td>${METRICS_MYSQL_PASS}</td>
            </tr>
            <tr>
               <td>attributes</td>
               <td></td>
            </tr>
         </tbody>
      </table>
      <h2>Flat Files</h2>
      <p>
         t.b.d.
         
      </p>
      <h2><a name="Steps">Steps</a></h2><br><div class="&#xA;&#x9;&#x9;&#x9;step-icon&#xA;&#x9;&#x9;&#x9;step-icon-DBLookup"></div>
      <h3 class="step-heading"><a name="Database lookup-text" href="#Database lookup-icon">Database lookup</a></h3>
      <p>
         This job entry does not have a description.
         
      </p><br><div class="&#xA;&#x9;&#x9;&#x9;step-icon&#xA;&#x9;&#x9;&#x9;step-icon-FilterRows"></div>
      <h3 class="step-heading"><a name="Find missing locations-text" href="#Find missing locations-icon">Find missing locations</a></h3>
      <p>
         This job entry does not have a description.
         
      </p><br><div class="&#xA;&#x9;&#x9;&#x9;step-icon&#xA;&#x9;&#x9;&#x9;step-icon-InsertUpdate"></div>
      <h3 class="step-heading"><a name="Insert / Update-text" href="#Insert / Update-icon">Insert / Update</a></h3>
      <p>
         This job entry does not have a description.
         
      </p><br><div class="&#xA;&#x9;&#x9;&#x9;step-icon&#xA;&#x9;&#x9;&#x9;step-icon-DBLookup"></div>
      <h3 class="step-heading"><a name="Lookup location_id-text" href="#Lookup location_id-icon">Lookup location_id</a></h3>
      <p>
         This job entry does not have a description.
         
      </p><br><div class="&#xA;&#x9;&#x9;&#x9;step-icon&#xA;&#x9;&#x9;&#x9;step-icon-DBLookup"></div>
      <h3 class="step-heading"><a name="Lookup new location_id-text" href="#Lookup new location_id-icon">Lookup new location_id</a></h3>
      <p>
         This job entry does not have a description.
         
      </p><br><div class="&#xA;&#x9;&#x9;&#x9;step-icon&#xA;&#x9;&#x9;&#x9;step-icon-MappingInput"></div>
      <h3 class="step-heading"><a name="Mapping input specification-text" href="#Mapping input specification-icon">Mapping input specification</a></h3>
      <p>
         This job entry does not have a description.
         
      </p>
      <h4>Fields</h4>
      <table>
         <thead>
            <tr>
               <th>Position</th>
               <th>name</th>
               <th>type</th>
               <th>length</th>
               <th>precision</th>
            </tr>
         </thead>
         <tbody>
            <tr>
               <th>1</th>
               <td>client_ip_address</td>
               <td>String</td>
               <td>-1</td>
               <td>-1</td>
            </tr>
         </tbody>
      </table><br><div class="&#xA;&#x9;&#x9;&#x9;step-icon&#xA;&#x9;&#x9;&#x9;step-icon-MappingOutput"></div>
      <h3 class="step-heading"><a name="Mapping output specification-text" href="#Mapping output specification-icon">Mapping output specification</a></h3>
      <p>
         This job entry does not have a description.
         
      </p><br><div class="&#xA;&#x9;&#x9;&#x9;step-icon&#xA;&#x9;&#x9;&#x9;step-icon-MaxMindGeoIPLookup"></div>
      <h3 class="step-heading"><a name="MaxMind GeoIP Lookup-text" href="#MaxMind GeoIP Lookup-icon">MaxMind GeoIP Lookup</a></h3>
      <p>
         This job entry does not have a description.
         
      </p>
      <h4>Fields</h4>
      <table>
         <thead>
            <tr>
               <th>Position</th>
               <th>name</th>
               <th>lookup_type</th>
               <th>ifnull</th>
            </tr>
         </thead>
         <tbody>
            <tr>
               <th>1</th>
               <td>country_code</td>
               <td>country_code</td>
               <td>??</td>
            </tr>
            <tr>
               <th>2</th>
               <td>country_name</td>
               <td>country_name</td>
               <td>Unknown</td>
            </tr>
            <tr>
               <th>3</th>
               <td>region_code</td>
               <td>region_code</td>
               <td>??</td>
            </tr>
            <tr>
               <th>4</th>
               <td>region_name</td>
               <td>region_name</td>
               <td>Unknown</td>
            </tr>
            <tr>
               <th>5</th>
               <td>city_name</td>
               <td>city_name</td>
               <td>Unknown</td>
            </tr>
            <tr>
               <th>6</th>
               <td>latitude</td>
               <td>latitude</td>
               <td>0.0000</td>
            </tr>
            <tr>
               <th>7</th>
               <td>longitude</td>
               <td>longitude</td>
               <td>0.0000</td>
            </tr>
            <tr>
               <th>8</th>
               <td>timezone</td>
               <td>timezone</td>
               <td></td>
            </tr>
         </tbody>
      </table><br><div class="&#xA;&#x9;&#x9;&#x9;step-icon&#xA;&#x9;&#x9;&#x9;step-icon-SelectValues"></div>
      <h3 class="step-heading"><a name="Remove continent-text" href="#Remove continent-icon">Remove continent</a></h3>
      <p>
         This job entry does not have a description.
         
      </p>        N
              continent_code
                    continent_name
          <br><div class="&#xA;&#x9;&#x9;&#x9;step-icon&#xA;&#x9;&#x9;&#x9;step-icon-SelectValues"></div>
      <h3 class="step-heading"><a name="Remove location_id-text" href="#Remove location_id-icon">Remove location_id</a></h3>
      <p>
         This job entry does not have a description.
         
      </p>        N
              location_id
          <script type="text/javascript" src="../../js/wz_jsgraphics.js"></script><script src="../../js/kettle.js"></script><script type="text/javascript" src="../../js/shCore.js"></script><script type="text/javascript" src="../../js/shBrushBash.js"></script><script type="text/javascript" src="../../js/shBrushJava.js"></script><script type="text/javascript" src="../../js/shBrushJScript.js"></script><script type="text/javascript" src="../../js/shBrushSql.js"></script><script type="text/javascript" src="../../js/shBrushXml.js"></script><script type="text/javascript">
            SyntaxHighlighter.all();
        </script></body>
</html>